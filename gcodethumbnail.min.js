function preview(e,t,n){function i(e,t){var n=Math.abs(e.size.max.x-e.size.min.x);var i=Math.abs(e.size.max.y-e.size.min.y);var a=parseInt(t.width,10),r=parseInt(t.height,10);return Math.min(a/n,r/i)}function a(e,t,n,i,a,r){var s=Math.round(t*(i.start.x-n.x));var o=Math.round(a-t*(i.start.y-n.y));var h=Math.round(t*(i.end.x-n.x));var v=Math.round(a-t*(i.end.y-n.y));e.beginPath();e.moveTo(s,o);e.lineTo(h,v);e.strokeStyle=r;e.lineWidth=2;e.stroke();e.closePath()}function r(e,t,n,i,a,r){var s=0;var o=i.beziers,h={};e.beginPath();for(s=0;s<o.length;s++){h=o[s];e.moveTo(t*(h.p0.x-n.x),a-t*(h.p0.y-n.y));e.bezierCurveTo(t*(h.p1.x-n.x),a-t*(h.p1.y-n.y),t*(h.p2.x-n.x),a-t*(h.p2.y-n.y),t*(h.p3.x-n.x),a-t*(h.p3.y-n.y))}e.strokeStyle=r;e.lineWidth=2;e.stroke();e.closePath()}if(t===undefined){return}var s=gcodetogeometry.parse(e);if(s.size.max.x===s.size.min.x&&s.size.max.y===s.size.min.y){return}var o={x:s.size.min.x,y:s.size.min.y};var h=0,v=i(s,n);var y=parseInt(n.height,10);var u=n.getContext("2d");u.clearRect(0,0,n.width,n.height);u.beginPath();u.rect(0,0,n.width,n.height);u.fillStyle="white";u.fill();s.lines.map(function(e){if(e.type==="G0"&&t.G0!==undefined){a(u,v,o,e,y,t.G0)}else if(e.type==="G1"&&t.G1!==undefined){a(u,v,o,e,y,t.G1)}else if((e.type==="G2"||e.type==="G3")&&t.G2G3!==undefined){r(u,v,o,e,y,t.G2G3)}})}function getCanvas(e,t,n,i){var a=document.createElement("canvas");a.width=n;a.height=i;preview(e,t,a);return a}function getBase64(e,t,n,i){var a=getCanvas(e,t,n,i);return a.toDataURL("img/png")}function getBase64Jpeg80(e,t,n,i){var a=getCanvas(e,t,n,i);return a.toDataURL("img/jpeg",80)}