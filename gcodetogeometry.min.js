!function(a,b){"object"==typeof exports&&"object"==typeof module?module.exports=b():"function"==typeof define&&define.amd?define([],b):"object"==typeof exports?exports.gcodetogeometry=b():a.gcodetogeometry=b()}(this,function(){return function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={exports:{},id:d,loaded:!1};return a[d].call(e.exports,e,e.exports,b),e.loaded=!0,e.exports}var c={};return b.m=a,b.c=c,b.p="",b(0)}([function(a,b,c){var d=c(1),e=c(2).StraightLine,f=c(2).CurvedLine,g=c(3).GParser,h=function(a){"use strict";function b(a){var b=a.split("(")[0].split(";")[0];return b.split(/\s/).join("").trim()}function c(a){var b={},c=0,d="",e="",f=[],g=!0;for(c=0;c<a.words.length;c++)d=a.words[c][0],e=a.words[c][1],"G"===d||"M"===d?(g===!1&&(f.push(b),b={}),b.type=d+e,g=!1):b[d.toLowerCase()]=parseFloat(e,10);return f.push(b),f}function h(a,b){var c=0,d=0,e=!0;for(d=b.length-1;d>=0;d--){for(c=a.length-1;c>=0;c--)if(e=!1,b[d].toUpperCase()===a[c].toUpperCase()){e=!0,a.splice(c,1);break}if(e===!1)return!0}return!1}function i(a,b){var c=["x","y","z"],d=0;for(d=c.length-1;d>=0;d--)a.min[c[d]]>b.min[c[d]]&&(a.min[c[d]]=b.min[c[d]]),a.max[c[d]]<b.max[c[d]]&&(a.max[c[d]]=b.max[c[d]])}function j(a,b,c){return{line:a,message:b,isSkipped:c}}function k(a,b,c,d){var e=a,f=void 0===e.f?d.feedrate:e.f;return void 0!==e.type&&"G1"!==e.type&&"G2"!==e.type&&"G3"!==e.type?!1:f>0?!1:0>f?(b.push(j(c,"(warning) Cannot use a negative feed rate (the absolute value is used).",!1)),e.f=Math.abs(f),!1):(b.push(j(c,"(error) Cannot use a null feed rate (skipped).",!0)),d.feedrate=0,!0)}function l(a,b){void 0===a.type&&""!==b&&(a.type=b)}function m(a,b,c,e){var f={x:a.x,y:a.y,z:a.z},g=e===!1?1:d.MILLIMETER_TO_INCH;return c===!0?(void 0!==b.x&&(f.x+=b.x*g),void 0!==b.y&&(f.y+=b.y*g),void 0!==b.z&&(f.z+=b.z*g)):(void 0!==b.x&&(f.x=b.x*g),void 0!==b.y&&(f.y=b.y*g),void 0!==b.z&&(f.z=b.z*g)),f}function n(a,b,c){var d=["X","Y","Z"],e=Object.keys(a);return e.splice(e.indexOf("type"),1),h(d,e)===!0&&b.push(j(c,"(warning) Some parameters are wrong.",!1)),!0}function o(a,b,c,d){var e=["X","Y","Z","F"],f=Object.keys(a);return f.splice(f.indexOf("type"),1),h(e,f)===!0&&b.push(j(c,"(warning) Some parameters are wrong.",!1)),!k(a,b,c,d)}function p(a,b,c,d){var e=["X","Y","Z","F","I","J","K","R"],f=Object.keys(a);return f.splice(f.indexOf("type"),1),h(e,f)===!0&&b.push(j(c,"(warning) Some parameters are wrong.",!1)),void 0===a.r&&void 0===a.i&&void 0===a.j&&void 0===a.k?(b.push(j(c,"(error) No parameter R, I, J or K.",!0)),!1):void 0===a.r||void 0===a.i&&void 0===a.j&&void 0===a.k?!k(a,b,c,d):(b.push(j(c,"(error) Cannot use R and I, J or K at the same time.",!0)),!1)}function q(a,b,c,f,g){var h=m(b.position,a,b.relative,b.inMm),j=new e(c,b.position,h,a,b);b.previousMoveCommand=a.type,i(g,j.getSize()),f.push(j.returnLine()),b.position=d.copyObject(j.end),void 0!==a.f&&(b.feedrate=a.f)}function r(a,b,c,e,g,h){var k=m(b.position,a,b.relative,b.inMm),l=new f(c,b.position,k,a,b);if(l.center!==!1){var n=l.returnLine();if(n===!1)return void h.push(j(c,"(error) Impossible to create arc.",!0));b.feedrate=l.feedrate,b.previousMoveCommand=a.type,i(g,l.getSize()),e.push(n),b.position=d.copyObject(l.end)}else h.push(j(c,"(error) Physically impossible to do with those values.",!0))}function s(a,b,c,d,e,f){if(void 0===a.type&&0===Object.keys(a).length)return!0;if(l(a,b.previousMoveCommand),void 0===a.type)void 0!==a.f&&(k(a,f,c,b.feedrate),b.feedrate=a.f);else if("G0"===a.type&&n(a,f,c)===!0)q(a,b,c,d,e);else if("G1"===a.type&&o(a,f,c,b)===!0)q(a,b,c,d,e);else if("G2"!==a.type&&"G3"!==a.type||p(a,f,c,b)!==!0){if("G17"===a.type)b.crossAxe="z";else if("G18"===a.type)b.crossAxe="y";else if("G19"===a.type)b.crossAxe="x";else if("G20"===a.type)b.inMm=!1,t===!1&&(u=!0,t=!0);else if("G21"===a.type)b.inMm=!0,t===!1&&(u=!1,t=!0);else if("G90"===a.type)b.relative=!1;else if("G91"===a.type)b.relative=!0;else if("M2"===a.type)return!1}else r(a,b,c,d,e,f);return!0}var t=!1,u=!0,v={min:{x:0,y:0,z:0},max:{x:0,y:0,z:0}},w=0,x=0,y=[],z=!0,A=[],B=[],C={feedrate:0,previousMoveCommand:"",crossAxe:"z",inMm:!1,relative:!1,position:{x:0,y:0,z:0}};if("string"!=typeof a||""===a)return{gcode:[],lines:[],size:v,displayInInch:u,errorList:[{line:0,message:"(error) No command."}]};var D=a.split("\n");for(w=0;w<D.length&&z===!0;){for(y=c(g.parse(b(D[w]).toUpperCase())),x=0;x<y.length&&z===!0;)z=s(y[x],C,w+1,A,v,B),x++;w++}return w<D.length&&B.push(j(w+1,"(warning) The next code is not executed.",!1)),{gcode:D,lines:A,size:v,displayInInch:u,errorList:B}};b.parse=h},function(a,b){"use strict";var c={};c.INCH_TO_MILLIMETER=25.4,c.MILLIMETER_TO_INCH=.03937008,c.FLOAT_PRECISION=.001,c.calculateFeedrate=function(a,b){return b===!1?a:a*c.MILLIMETER_TO_INCH},c.nearlyEqual=function(a,b,d){var e=void 0===d?c.FLOAT_PRECISION:d;return Math.abs(b-a)<=e},c.swapObjects=function(a,b){function d(a,b,c){var d;d=a[c],a[c]=b[c],b[c]=d}var e=Object.keys(a),f=0;for(f=0;f<e.length;f++)"object"==typeof a[e[f]]?c.swapObjects(a[e[f]],b[e[f]]):d(a,b,e[f])},c.copyObject=function(a){var b=Object.keys(a),d=0,e={};for(d=0;d<b.length;d++)"object"==typeof a[b[d]]?e[b[d]]=c.copyObject(a[b[d]]):e[b[d]]=a[b[d]];return e},c.movePoint=function(a,b){var c=Object.keys(b),d=0;for(d=0;d<c.length;d++)void 0!==a[c[d]]&&(a[c[d]]+=b[c[d]])},c.dotProduct2=function(a,b){return a.x*b.x+a.y*b.y},c.crossProduct2=function(a,b){return a.x*b.y-b.x*a.y},c.lengthVector3=function(a){return Math.sqrt(a.x*a.x+a.y*a.y+a.z*a.z)},c.findAxes=function(a){return"x"===a.toLowerCase()?{re:"y",im:"z",cr:"x"}:"y"===a.toLowerCase()?{re:"z",im:"x",cr:"y"}:{re:"x",im:"y",cr:"z"}},c.scaleAndRotation=function(a,b,c,d,e,f,g){var h=a,i=b,j=c,k=e,l=Math.cos(d),m=Math.sin(d),n=i[f],o=i[g],p=h[f],q=h[g];j[f]=k*((n-p)*l-(o-q)*m)+p,j[g]=k*((o-q)*l+(n-p)*m)+q},c.findAngleVectors2=function(a,b){var d=c.crossProduct2(a,b)<0?-1:1,e=c.dotProduct2(a,b),f=Math.sqrt(a.x*a.x+a.y*a.y),g=Math.sqrt(b.x*b.x+b.y*b.y);return 0===f||0===g?0:d*Math.acos(e/(f*g))},c.findAngleOrientedVectors2=function(a,b,d){var e=c.findAngleVectors2(a,b);return d===!1&&e>0?e-2*Math.PI:d===!0&&0>e?2*Math.PI+e:e},c.isInclude=function(a,b,c){return b>c?a>=c&&b>=a:a>=b&&c>=a};var d=Object.keys(c),e=0;for(e=0;e<d.length;e++)b[d[e]]=c[d[e]]},function(a,b,c){var d=c(1),e=function(a,b,c,e,f){"use strict";function g(a,b,e,f){h.index=a,h.word=e.type,h.start={x:b.x,y:b.y,z:b.z},h.end=c,"G0"===e.type?h.feedrate=0:void 0===e.f?h.feedrate=f.feedrate:h.feedrate=d.calculateFeedrate(e.f,f.inMm)}var h=this;h.returnLine=function(){return{lineNumber:h.index,type:h.word,start:h.start,end:h.end,feedrate:h.feedrate}},h.getSize=function(){return{min:{x:Math.min(h.start.x,h.end.x),y:Math.min(h.start.y,h.end.y),z:Math.min(h.start.z,h.end.z)},max:{x:Math.max(h.start.x,h.end.x),y:Math.max(h.start.y,h.end.y),z:Math.max(h.start.z,h.end.z)}}},g(a,b,e,f)},f=function(a,b,c,e,f){"use strict";function g(){var a=d.findAxes(s.crossAxe),b={x:s.start[a.re]-s.center[a.re],y:s.start[a.im]-s.center[a.im],z:0},c={x:s.end[a.re]-s.center[a.re],y:s.end[a.im]-s.center[a.im],z:0};return d.findAngleOrientedVectors2(b,c,s.clockwise===!1)}function h(){var a=d.findAxes(s.crossAxe),b={x:s.start[a.re]-s.center[a.re],y:s.start[a.im]-s.center[a.im],z:0};return d.lengthVector3(b)}function i(a,b){var c={},d={},e={},f={};return a=Math.abs(a),a===Math.PI/2?(c={x:.707106781186548,y:.707106781186548,z:0},d={x:1.097631072937817,y:.316582489435277,z:0}):(c={x:Math.cos(a/2),y:Math.sin(a/2),z:0},d={x:(4-c.x)/3,y:(1-c.x)*(3-c.x)/(3*c.y),z:0}),c.x*=b,c.y*=b,d.x*=b,d.y*=b,e={x:d.x,y:-d.y,z:0},f={x:c.x,y:-c.y,z:0},{p0:c,p1:d,p2:e,p3:f}}function j(a,b,c,e){var f=0;return b===!1&&(d.swapObjects(a.p0,a.p3),d.swapObjects(a.p1,a.p2)),f=c/3,"z"===e.toLowerCase()?(a.p0.z=0,a.p1.z=f,a.p2.z=2*f,a.p3.z=3*f):"x"===e.toLowerCase()?(a.p0.z=a.p0.y,a.p0.y=a.p0.x,a.p0.x=0,a.p1.z=a.p1.y,a.p1.y=a.p1.x,a.p1.x=f,a.p2.z=a.p2.y,a.p2.y=a.p2.x,a.p2.x=2*f,a.p3.z=a.p3.y,a.p3.y=a.p3.x,a.p3.x=3*f):"y"===e.toLowerCase()&&(a.p0.z=a.p0.x,a.p0.x=a.p0.y,a.p0.y=0,a.p1.z=a.p1.x,a.p1.x=a.p1.y,a.p1.y=f,a.p2.z=a.p2.x,a.p2.x=a.p2.y,a.p2.y=2*f,a.p3.z=a.p3.x,a.p3.x=a.p3.y,a.p3.y=3*f),a}function k(a,b,c,e,f){var g={x:0,y:0,z:0};d.scaleAndRotation(g,a.p0,a.p0,c,1,e,f),d.scaleAndRotation(g,a.p1,a.p1,c,1,e,f),d.scaleAndRotation(g,a.p2,a.p2,c,1,e,f),d.scaleAndRotation(g,a.p3,a.p3,c,1,e,f),d.movePoint(a.p0,b),d.movePoint(a.p1,b),d.movePoint(a.p2,b),d.movePoint(a.p3,b)}function l(a,b,c,e,f){var g=[],h=d.copyObject(s.center),i=d.findAxes(s.crossAxe),j={x:s.start[i.re]-h[i.re],y:s.start[i.im]-h[i.im]},l=0,m=0,n=s.clockwise===!0?-1:1;if(0===a&&0===c)return g;if(a>0)for(m=d.findAngleOrientedVectors2({x:b.p0[i.re],y:b.p0[i.im]},j,s.clockwise===!1),l=0;a>l;l++)g.push(d.copyObject(b)),k(g[l],h,m,i.re,i.im),m+=1.570796326794897*n,h[s.crossAxe]+=f;return c>0&&(m=d.findAngleOrientedVectors2({x:e.p0[i.re],y:e.p0[i.im]},j,s.clockwise===!1),0!==a&&(m+=1.570796326794897*a*n),g.push(d.copyObject(e)),k(g[l],h,m,i.re,i.im)),g[0].p0.x=s.start.x,g[0].p0.y=s.start.y,g[0].p0.z=s.start.z,g[g.length-1].p3.x=s.end.x,g[g.length-1].p3.y=s.end.y,g[g.length-1].p3.z=s.end.z,g}function m(){var a=0,b=1,c={},d={},e=0,f=0,k=0,m=g(),n=h(),o=Math.abs(m),p=1.570796326794897;return 0===m||0===n?[]:(o>p&&(a=parseInt(o/p,10),b=o%p!==0?1:0),k=(s.end[s.crossAxe]-s.start[s.crossAxe])/o,e=p*k,f=(o-a*p)*k,a>0&&(c=i(p,n),j(c,0>m,e,s.crossAxe)),b>0&&(m=o-a*p,s.clockwise===!0&&(m=-m),d=i(m,n),j(d,0>m,f,s.crossAxe)),l(a,c,b,d,e))}function n(){var a={},b=[],c=0,e=1.570796326794897,f=s.clockwise===!0?-1:1,g=f*Math.PI*2,m=h(),n=0,o=d.copyObject(s.center),p=d.findAxes(s.crossAxe);if(0===m)return[];for(c=(s.end[s.crossAxe]-s.start[s.crossAxe])/4,a=i(e,m),j(a,s.clockwise,c,s.crossAxe),n=0;4>n;n++)b.push(d.copyObject(a)),k(b[n],o,g,p.re,p.im),g+=e*f,o[s.crossAxe]+=c;return l(4,a,0,a,c)}function o(a,b,c,e,f){var g={x:b.x-a.x,y:b.y-a.y,z:b.z-a.z},h=0,i=1,j=0,k=Math.abs(c),l=0,m={x:0,y:0,z:0},n=d.findAxes(f);if(j=Math.sqrt(g[n.re]*g[n.re]+g[n.im]*g[n.im]),j>Math.abs(2*c)||0===j)return!1;if(h=Math.acos(j/(2*k)),i=k/j,d.scaleAndRotation(a,b,m,h,i,n.re,n.im),l=d.findAngleVectors2({x:a[n.re]-m[n.re],y:a[n.im]-m[n.im]},{x:b[n.re]-m[n.re],y:b[n.im]-m[n.im]}),e===!0){if(c>0&&-Math.PI<=l&&0>=l)return m;if(0>c&&l>=0&&l<=Math.PI)return m}else{if(c>0&&l>=0&&l<=Math.PI)return m;if(0>c&&-Math.PI<=l&&0>=l)return m}return d.scaleAndRotation(a,b,m,-h,i,n.re,n.im),m}function p(a,b,c,e,f,g){var h,i,j=g===!1?1:d.MILLIMETER_TO_INCH,k={x:a.x,y:a.y,z:a.z},l=d.findAxes(f);if(void 0===c.r){if(void 0!==c.i&&(k.x+=c.i*j),void 0!==c.j&&(k.y+=c.j*j),void 0!==c.k&&(k.z+=c.k*j),h=Math.pow(k[l.re]-a[l.re],2),h+=Math.pow(k[l.im]-a[l.im],2),i=Math.pow(k[l.re]-b[l.re],2),i+=Math.pow(k[l.im]-b[l.im],2),d.nearlyEqual(h,0)===!0||d.nearlyEqual(i,0)===!0)return!1;if(d.nearlyEqual(h,i)===!1)return!1}else if(k=o(a,b,c.r*j,e,f),k===!1)return!1;return k[f]=a[f],k}function q(a,b,c,e){var f=d.findAngleOrientedVectors2(e,{x:a,y:b},s.clockwise===!1);return d.isInclude(f,0,c)===!0}function r(a,b,e,f){s.index=a,s.word=e.type,s.start={x:b.x,y:b.y,z:b.z},s.end=c,s.clockwise="G2"===e.type,s.center=p(b,s.end,e,s.clockwise,f.crossAxe,f.inMm),s.crossAxe=f.crossAxe,void 0===e.f?s.feedrate=f.feedrate:s.feedrate=d.calculateFeedrate(e.f,f.inMm)}var s=this;s.returnLine=function(){var a=[],b=d.findAxes(s.crossAxe);return a=s.start[b.re]===s.end[b.re]&&s.start[b.im]===s.end[b.im]?n():m(),0===a.length?!1:{lineNumber:s.index,type:s.word,beziers:a,feedrate:s.feedrate}},s.getSize=function(){var a=d.findAxes(s.crossAxe),b={x:s.start[a.re]-s.center[a.re],y:s.start[a.im]-s.center[a.im]},c=h(),e=g(),f={x:0,y:0,z:0},i={x:0,y:0,z:0};return s.start[a.re]===s.end[a.re]&&s.start[a.im]===s.end[a.im]?(f[a.re]=s.center[a.re]-c,f[a.im]=s.center[a.im]-c,f[a.cr]=Math.min(s.start[a.cr],s.end[a.cr]),i[a.re]=s.center[a.re]+c,i[a.im]=s.center[a.im]+c,i[a.cr]=Math.max(s.start[a.cr],s.end[a.cr]),{min:f,max:i}):(f.x=Math.min(s.start.x,s.end.x),f.y=Math.min(s.start.y,s.end.y),f.z=Math.min(s.start.z,s.end.z),i.x=Math.max(s.start.x,s.end.x),i.y=Math.max(s.start.y,s.end.y),i.z=Math.max(s.start.z,s.end.z),q(0,1,e,b)===!0&&(i[a.im]=s.center[a.im]+c),q(0,-1,e,b)===!0&&(f[a.im]=s.center[a.im]-c),q(1,0,e,b)===!0&&(i[a.re]=s.center[a.re]+c),q(-1,0,e,b)===!0&&(f[a.re]=s.center[a.re]-c),{min:f,max:i})},r(a,b,e,f)};b.StraightLine=e,b.CurvedLine=f},function(a,b){var c=function(){function a(a,b){function c(){this.constructor=a}c.prototype=b.prototype,a.prototype=new c}function b(a,b,c,d,e,f){this.message=a,this.expected=b,this.found=c,this.offset=d,this.line=e,this.column=f,this.name="SyntaxError"}function c(a){function c(){return a.substring(Jb,Ib)}function d(b){function c(b,c,d){var e,f;for(e=c;d>e;e++)f=a.charAt(e),"\n"===f?(b.seenCR||b.line++,b.column=1,b.seenCR=!1):"\r"===f||"\u2028"===f||"\u2029"===f?(b.line++,b.column=1,b.seenCR=!0):(b.column++,b.seenCR=!1)}return Kb!==b&&(Kb>b&&(Kb=0,Lb={line:1,column:1,seenCR:!1}),c(Lb,Kb,b),Kb=b),Lb}function e(a){Mb>Ib||(Ib>Mb&&(Mb=Ib,Nb=[]),Nb.push(a))}function f(c,e,f){function g(a){var b=1;for(a.sort(function(a,b){return a.description<b.description?-1:a.description>b.description?1:0});b<a.length;)a[b-1]===a[b]?a.splice(b,1):b++}function h(a,b){function c(a){function b(a){return a.charCodeAt(0).toString(16).toUpperCase()}return a.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(a){return"\\x0"+b(a)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(a){return"\\x"+b(a)}).replace(/[\u0180-\u0FFF]/g,function(a){return"\\u0"+b(a)}).replace(/[\u1080-\uFFFF]/g,function(a){return"\\u"+b(a)})}var d,e,f,g=new Array(a.length);for(f=0;f<a.length;f++)g[f]=a[f].description;return d=a.length>1?g.slice(0,-1).join(", ")+" or "+g[a.length-1]:g[0],e=b?'"'+c(b)+'"':"end of input","Expected "+d+" but "+e+" found."}var i=d(f),j=f<a.length?a.charAt(f):null;return null!==e&&g(e),new b(null!==c?c:h(e,j),e,j,f,i.line,i.column)}function g(){var a;return a=h()}function h(){var a,b,c,d;if(a=Ib,b=j(),b===B&&(b=F),b!==B){for(c=[],d=i();d!==B;)c.push(d),d=i();c!==B?(Jb=a,b=G(b,c),a=b):(Ib=a,a=E)}else Ib=a,a=E;return a}function i(){var a,b,c;return a=Ib,b=y(),b!==B?(c=q(),c!==B?(Jb=a,b=H(b,c),a=b):(Ib=a,a=E)):(Ib=a,a=E),a}function j(){var b,c,d;return b=Ib,78===a.charCodeAt(Ib)?(c=I,Ib++):(c=B,0===Ob&&e(J)),c!==B?(d=k(),d!==B?(c=[c,d],b=c):(Ib=b,b=E)):(Ib=b,b=E),b}function k(){var b,c,d;if(b=Ib,c=[],K.test(a.charAt(Ib))?(d=a.charAt(Ib),Ib++):(d=B,0===Ob&&e(L)),d!==B)for(;d!==B;)c.push(d),K.test(a.charAt(Ib))?(d=a.charAt(Ib),Ib++):(d=B,0===Ob&&e(L));else c=E;return c!==B&&(Jb=b,c=M()),b=c}function l(){var b,c,d,f,g,h,i;if(b=Ib,N.test(a.charAt(Ib))?(c=a.charAt(Ib),Ib++):(c=B,0===Ob&&e(O)),c===B&&(c=F),c!==B){if(d=[],K.test(a.charAt(Ib))?(f=a.charAt(Ib),Ib++):(f=B,0===Ob&&e(L)),f!==B)for(;f!==B;)d.push(f),K.test(a.charAt(Ib))?(f=a.charAt(Ib),Ib++):(f=B,0===Ob&&e(L));else d=E;if(d!==B){if(f=Ib,P.test(a.charAt(Ib))?(g=a.charAt(Ib),Ib++):(g=B,0===Ob&&e(Q)),g!==B){if(h=[],K.test(a.charAt(Ib))?(i=a.charAt(Ib),Ib++):(i=B,0===Ob&&e(L)),i!==B)for(;i!==B;)h.push(i),K.test(a.charAt(Ib))?(i=a.charAt(Ib),Ib++):(i=B,0===Ob&&e(L));else h=E;h!==B?(g=[g,h],f=g):(Ib=f,f=E)}else Ib=f,f=E;f===B&&(f=F),f!==B?(Jb=b,c=R(),b=c):(Ib=b,b=E)}else Ib=b,b=E}else Ib=b,b=E;return b}function m(){var b,c,d,f;return b=Ib,91===a.charCodeAt(Ib)?(c=S,Ib++):(c=B,0===Ob&&e(T)),c!==B?(d=t(),d!==B?(93===a.charCodeAt(Ib)?(f=U,Ib++):(f=B,0===Ob&&e(V)),f!==B?(Jb=b,c=W(d),b=c):(Ib=b,b=E)):(Ib=b,b=E)):(Ib=b,b=E),b}function n(){var b,c,d,f,g;return b=Ib,a.substr(Ib,4)===X?(c=X,Ib+=4):(c=B,0===Ob&&e(Y)),c!==B?(d=m(),d!==B?(47===a.charCodeAt(Ib)?(f=Z,Ib++):(f=B,0===Ob&&e($)),f!==B?(g=m(),g!==B?(Jb=b,c=_(d,g),b=c):(Ib=b,b=E)):(Ib=b,b=E)):(Ib=b,b=E)):(Ib=b,b=E),b}function o(){var a,b,c;return a=Ib,b=x(),b!==B?(c=m(),c!==B?(Jb=a,b=aa(b,c),a=b):(Ib=a,a=E)):(Ib=a,a=E),a}function p(){var b,c,d;return b=Ib,35===a.charCodeAt(Ib)?(c=ba,Ib++):(c=B,0===Ob&&e(ca)),c!==B?(d=m(),d===B&&(d=l(),d===B&&(d=p())),d!==B?(Jb=b,c=da(d),b=c):(Ib=b,b=E)):(Ib=b,b=E),b}function q(){var a;return a=m(),a===B&&(a=l(),a===B&&(a=n(),a===B&&(a=o(),a===B&&(a=p())))),a}function r(){var a,b,c,d,e,f;if(a=Ib,b=q(),b!==B){for(c=[],d=Ib,e=u(),e!==B?(f=q(),f!==B?(e=[e,f],d=e):(Ib=d,d=E)):(Ib=d,d=E);d!==B;)c.push(d),d=Ib,e=u(),e!==B?(f=q(),f!==B?(e=[e,f],d=e):(Ib=d,d=E)):(Ib=d,d=E);c!==B?(Jb=a,b=ea(b,c),a=b):(Ib=a,a=E)}else Ib=a,a=E;return a}function s(){var a,b,c,d,e,f;if(a=Ib,b=r(),b!==B){for(c=[],d=Ib,e=v(),e!==B?(f=r(),f!==B?(e=[e,f],d=e):(Ib=d,d=E)):(Ib=d,d=E);d!==B;)c.push(d),d=Ib,e=v(),e!==B?(f=r(),f!==B?(e=[e,f],d=e):(Ib=d,d=E)):(Ib=d,d=E);c!==B?(Jb=a,b=fa(b,c),a=b):(Ib=a,a=E)}else Ib=a,a=E;return a}function t(){var a,b,c,d,e,f;if(a=Ib,b=s(),b!==B){for(c=[],d=Ib,e=w(),e!==B?(f=s(),f!==B?(e=[e,f],d=e):(Ib=d,d=E)):(Ib=d,d=E);d!==B;)c.push(d),d=Ib,e=w(),e!==B?(f=s(),f!==B?(e=[e,f],d=e):(Ib=d,d=E)):(Ib=d,d=E);c!==B?(Jb=a,b=fa(b,c),a=b):(Ib=a,a=E)}else Ib=a,a=E;return a}function u(){var b;return a.substr(Ib,2)===ga?(b=ga,Ib+=2):(b=B,0===Ob&&e(ha)),b}function v(){var b;return 42===a.charCodeAt(Ib)?(b=ia,Ib++):(b=B,0===Ob&&e(ja)),b===B&&(47===a.charCodeAt(Ib)?(b=Z,Ib++):(b=B,0===Ob&&e($)),b===B&&(a.substr(Ib,3)===ka?(b=ka,Ib+=3):(b=B,0===Ob&&e(la)))),b}function w(){var b;return 43===a.charCodeAt(Ib)?(b=ma,Ib++):(b=B,0===Ob&&e(na)),b===B&&(45===a.charCodeAt(Ib)?(b=oa,Ib++):(b=B,0===Ob&&e(pa)),b===B&&(a.substr(Ib,2)===qa?(b=qa,Ib+=2):(b=B,0===Ob&&e(ra)),b===B&&(a.substr(Ib,3)===sa?(b=sa,Ib+=3):(b=B,0===Ob&&e(ta)),b===B&&(a.substr(Ib,3)===ua?(b=ua,Ib+=3):(b=B,0===Ob&&e(va)))))),b}function x(){var b;return a.substr(Ib,3)===wa?(b=wa,Ib+=3):(b=B,0===Ob&&e(xa)),b===B&&(a.substr(Ib,4)===ya?(b=ya,Ib+=4):(b=B,0===Ob&&e(za)),b===B&&(a.substr(Ib,4)===Aa?(b=Aa,Ib+=4):(b=B,0===Ob&&e(Ba)),b===B&&(a.substr(Ib,3)===Ca?(b=Ca,Ib+=3):(b=B,0===Ob&&e(Da)),b===B&&(a.substr(Ib,3)===Ea?(b=Ea,Ib+=3):(b=B,0===Ob&&e(Fa)),b===B&&(a.substr(Ib,3)===Ga?(b=Ga,Ib+=3):(b=B,0===Ob&&e(Ha)),b===B&&(a.substr(Ib,3)===Ia?(b=Ia,Ib+=3):(b=B,0===Ob&&e(Ja)),b===B&&(a.substr(Ib,5)===Ka?(b=Ka,Ib+=5):(b=B,0===Ob&&e(La)),b===B&&(a.substr(Ib,2)===Ma?(b=Ma,Ib+=2):(b=B,0===Ob&&e(Na)),b===B&&(a.substr(Ib,3)===Oa?(b=Oa,Ib+=3):(b=B,0===Ob&&e(Pa)),b===B&&(a.substr(Ib,4)===Qa?(b=Qa,Ib+=4):(b=B,0===Ob&&e(Ra)),b===B&&(a.substr(Ib,3)===Sa?(b=Sa,Ib+=3):(b=B,0===Ob&&e(Ta)),b===B&&(a.substr(Ib,6)===Ua?(b=Ua,Ib+=6):(b=B,0===Ob&&e(Va)))))))))))))),b}function y(){var b;return 65===a.charCodeAt(Ib)?(b=Wa,Ib++):(b=B,0===Ob&&e(Xa)),b===B&&(66===a.charCodeAt(Ib)?(b=Ya,Ib++):(b=B,0===Ob&&e(Za)),b===B&&(67===a.charCodeAt(Ib)?(b=$a,Ib++):(b=B,0===Ob&&e(_a)),b===B&&(68===a.charCodeAt(Ib)?(b=ab,Ib++):(b=B,0===Ob&&e(bb)),b===B&&(70===a.charCodeAt(Ib)?(b=cb,Ib++):(b=B,0===Ob&&e(db)),b===B&&(71===a.charCodeAt(Ib)?(b=eb,Ib++):(b=B,0===Ob&&e(fb)),b===B&&(72===a.charCodeAt(Ib)?(b=gb,Ib++):(b=B,0===Ob&&e(hb)),b===B&&(73===a.charCodeAt(Ib)?(b=ib,Ib++):(b=B,0===Ob&&e(jb)),b===B&&(74===a.charCodeAt(Ib)?(b=kb,Ib++):(b=B,0===Ob&&e(lb)),b===B&&(75===a.charCodeAt(Ib)?(b=mb,Ib++):(b=B,0===Ob&&e(nb)),b===B&&(76===a.charCodeAt(Ib)?(b=ob,Ib++):(b=B,0===Ob&&e(pb)),b===B&&(77===a.charCodeAt(Ib)?(b=qb,Ib++):(b=B,0===Ob&&e(rb)),b===B&&(80===a.charCodeAt(Ib)?(b=sb,Ib++):(b=B,0===Ob&&e(tb)),b===B&&(81===a.charCodeAt(Ib)?(b=ub,Ib++):(b=B,0===Ob&&e(vb)),b===B&&(82===a.charCodeAt(Ib)?(b=wb,Ib++):(b=B,0===Ob&&e(xb)),b===B&&(83===a.charCodeAt(Ib)?(b=yb,Ib++):(b=B,0===Ob&&e(zb)),b===B&&(84===a.charCodeAt(Ib)?(b=Ab,Ib++):(b=B,0===Ob&&e(Bb)),b===B&&(88===a.charCodeAt(Ib)?(b=Cb,Ib++):(b=B,0===Ob&&e(Db)),b===B&&(89===a.charCodeAt(Ib)?(b=Eb,Ib++):(b=B,0===Ob&&e(Fb)),b===B&&(90===a.charCodeAt(Ib)?(b=Gb,Ib++):(b=B,0===Ob&&e(Hb))))))))))))))))))))),b}var z,A=arguments.length>1?arguments[1]:{},B={},C={start:g},D=g,E=B,F=null,G=function(a,b){return{N:a,words:b}},H=function(a,b){return[a,b]},I="N",J={type:"literal",value:"N",description:'"N"'},K=/^[0-9]/,L={type:"class",value:"[0-9]",description:"[0-9]"},M=function(){return parseInt(c())},N=/^[+\-]/,O={type:"class",value:"[+\\-]",description:"[+\\-]"},P=/^[.]/,Q={type:"class",value:"[.]",description:"[.]"},R=function(){return parseFloat(c())},S="[",T={type:"literal",value:"[",description:'"["'},U="]",V={type:"literal",value:"]",description:'"]"'},W=function(a){return a},X="ATAN",Y={type:"literal",value:"ATAN",description:'"ATAN"'},Z="/",$={type:"literal",value:"/",description:'"/"'},_=function(a,b){return{op:"ATAN",left:a,right:b}},aa=function(a,b){return{op:a,right:b}},ba="#",ca={type:"literal",value:"#",description:'"#"'},da=function(a){return{op:"#",right:a}},ea=function(a,b){return buildTree(a,b)},fa=function(a,b){return buildTree(a,b)},ga="**",ha={type:"literal",value:"**",description:'"**"'},ia="*",ja={type:"literal",value:"*",description:'"*"'},ka="MOD",la={type:"literal",value:"MOD",description:'"MOD"'},ma="+",na={type:"literal",value:"+",description:'"+"'},oa="-",pa={type:"literal",value:"-",description:'"-"'},qa="OR",ra={type:"literal",value:"OR",description:'"OR"'},sa="XOR",ta={type:"literal",value:"XOR",description:'"XOR"'},ua="AND",va={type:"literal",value:"AND",description:'"AND"'},wa="ABS",xa={type:"literal",value:"ABS",description:'"ABS"'},ya="ACOS",za={type:"literal",value:"ACOS",description:'"ACOS"'},Aa="ASIN",Ba={type:"literal",value:"ASIN",description:'"ASIN"'},Ca="COS",Da={type:"literal",value:"COS",description:'"COS"'},Ea="EXP",Fa={type:"literal",value:"EXP",description:'"EXP"'},Ga="FIX",Ha={type:"literal",value:"FIX",description:'"FIX"'},Ia="FUP",Ja={type:"literal",value:"FUP",description:'"FUP"'},Ka="ROUND",La={type:"literal",value:"ROUND",description:'"ROUND"'},Ma="LN",Na={type:"literal",value:"LN",description:'"LN"'},Oa="SIN",Pa={type:"literal",value:"SIN",description:'"SIN"'},Qa="SQRT",Ra={type:"literal",value:"SQRT",description:'"SQRT"'},Sa="TAN",Ta={type:"literal",value:"TAN",description:'"TAN"'},Ua="EXISTS",Va={type:"literal",value:"EXISTS",description:'"EXISTS"'},Wa="A",Xa={type:"literal",value:"A",description:'"A"'},Ya="B",Za={type:"literal",value:"B",description:'"B"'},$a="C",_a={type:"literal",value:"C",description:'"C"'},ab="D",bb={type:"literal",value:"D",description:'"D"'},cb="F",db={type:"literal",value:"F",description:'"F"'},eb="G",fb={type:"literal",value:"G",description:'"G"'},gb="H",hb={type:"literal",value:"H",description:'"H"'},ib="I",jb={type:"literal",value:"I",description:'"I"'},kb="J",lb={type:"literal",value:"J",description:'"J"'},mb="K",nb={type:"literal",value:"K",description:'"K"'},ob="L",pb={type:"literal",value:"L",description:'"L"'},qb="M",rb={type:"literal",value:"M",description:'"M"'},sb="P",tb={type:"literal",value:"P",description:'"P"'},ub="Q",vb={type:"literal",value:"Q",description:'"Q"'},wb="R",xb={type:"literal",value:"R",description:'"R"'},yb="S",zb={type:"literal",value:"S",description:'"S"'},Ab="T",Bb={type:"literal",value:"T",description:'"T"'},Cb="X",Db={type:"literal",value:"X",description:'"X"'},Eb="Y",Fb={type:"literal",value:"Y",description:'"Y"'},Gb="Z",Hb={type:"literal",value:"Z",description:'"Z"'},Ib=0,Jb=0,Kb=0,Lb={line:1,column:1,seenCR:!1},Mb=0,Nb=[],Ob=0;if("startRule"in A){if(!(A.startRule in C))throw new Error("Can't start parsing from rule \""+A.startRule+'".');D=C[A.startRule]}if(buildTree=function(a,b){if(0==b.length)return a;var c=b.shift(),d=c[0],e=c[1];return{left:a,right:buildTree(e,b),op:d}},z=D(),z!==B&&Ib===a.length)return z;throw z!==B&&Ib<a.length&&e({type:"end",description:"end of input"}),f(null,Nb,Mb)}return a(b,Error),{SyntaxError:b,parse:c}}();b.GParser=c}])});